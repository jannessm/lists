<div id="toggle-overlay" (click)="!pickerOpen ? focusInput=false : ''" [style.display]="focusInput ? 'block' : 'none'"></div>
<button class="menu" mat-icon-button [matMenuTriggerFor]="menu"><mat-icon>more_vert</mat-icon></button>
<mat-menu #menu="matMenu">
    <button mat-menu-item (click)="listSettings()">Einstellungen</button>
    <button mat-menu-item (click)="shareList()">Teilen</button>
    <button mat-menu-item (click)="deleteList()">Löschen</button>
</mat-menu>

<h1 *ngIf="list">{{list.name}}</h1>
<div class="users" *ngIf="list && list.shared">
    <button mat-mini-fab *ngFor="let user of list.users; let i = index" [class]="'user-fab-' + i % 12" disabled >{{user.substr(0, 2).toUpperCase()}}</button>
</div>

<div id="items-container" #itemsContainer>
    <div *ngFor="let slot of slots">
        <h2>{{ slot.name }}</h2>
    
        <div class="item" *ngFor="let item of slot.items" [class.item-done]="item.done" (pointerdown)="openUpdateDialog(item, slot.items)" (pointerup)="cancelUpdateDialog(item, slot.items)">
            <mat-checkbox (change)="toggleDone(item, slot.items)" [(ngModel)]="item.done" color="primary">
                <div class="item-content">{{ item.name }}
                    <mat-chip-list *ngIf="list && !list.groceries" disabled>
                        <mat-chip *ngIf="item.time && is_today(item)">{{item.time | date:'h:mm'}}</mat-chip>
                        <mat-chip *ngIf="item.time && !is_today(item)">{{item.time | date:'short'}}</mat-chip>
                    </mat-chip-list>
                    <button mat-mini-fab disabled *ngIf="list && list.shared && userEmail !== item.created_by" [class]="'mini-user-fab user-fab-' + list.users.indexOf(item.created_by) % 12">{{item.created_by.substr(0, 2).toUpperCase()}}</button>
                </div>
                <button mat-icon-button (click)="deleteItem(item)" *ngIf="item.done"><mat-icon>close</mat-icon></button>
            </mat-checkbox>
        </div>
    </div>
</div>

<div (click)="focusInput=true">
    <mat-toolbar class="toolbar-input" [style.bottom]="focusInput ? 0 : '78px'" [style.height]="list && list.groceries ? '78px' : '64px'">
        <input matInput placeholder="Hinzufügen" class="add-input" [(ngModel)]="newItem" autocomplete="off">
        <button mat-icon-button (click)="addItem()"><mat-icon>add</mat-icon></button>
    </mat-toolbar>

    <mat-toolbar class="toolbar-time" [style.display]="focusInput ? 'block' : 'none'" *ngIf="list && !list.groceries">
        <mat-chip-list [formControl]="newItemTime">
            <mat-chip (click)="toggleNewTimeSelected(chipToday)" #chipToday="matChip" value="today">Heute</mat-chip>
            <mat-chip (click)="toggleNewTimeSelected(chipTomorrow)" #chipTomorrow="matChip" value="tomorrow">Morgen</mat-chip>
            <mat-chip (click)="toggleNewTimeSelected(chipDiff); pickerToggleFocus()" #chipDiff="matChip" value="different">{{(timePickerDate | date:'short') || 'Andere'}}</mat-chip>
            <mat-chip (click)="toggleNewTimeSelected(chipSometime)" #chipSometime="matChip" value="sometime">Irgendwann</mat-chip>
        </mat-chip-list>
    </mat-toolbar>
    <input id="picker" type="text" #picker (change)="setTimePickerDate($event)">
</div>